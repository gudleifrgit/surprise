<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Sensorium ¬∑ mini-quest</title>
<meta name="theme-color" content="#000000">
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
  :root{--bg:#000;--fg:#eaeaea;--muted:#2a2a2a;--hint:#8b8b8b}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font:16px/1.55 system-ui,Inter,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:24px}
  .card{max-width:720px;width:100%;padding:22px 20px;border:1px solid var(--muted);border-radius:16px;background:rgba(255,255,255,.02);text-align:center}
  p{margin:0 0 10px}
  .btn{display:inline-block;margin:6px 5px;padding:10px 16px;border-radius:12px;border:1px solid var(--muted);background:#111;color:#eee;cursor:pointer}
  .btn:active{transform:scale(.98)}
  .muted{color:var(--hint)}
  .fade{animation:fade .28s ease}
  @keyframes fade{from{opacity:.25;transform:translateY(4px)}to{opacity:1;transform:none}}
</style>
    </head>
<body>
<div class="wrap"><div class="card fade" id="stage"></div></div>

<script>
  window.addEventListener("DOMContentLoaded", async () => {
  localStorage.clear();
  
 
  const tg = window.Telegram?.WebApp;
  tg.ready();
    tg.expand();


  // Persistence
  const K_DONE="sq_done", K_MODE="sq_mode", K_DAY="sq_day";
  const el = document.getElementById("stage");

  // Text utils
  const dayLabel = code => ({thu:"–í–µ—á–µ—Ä —á–µ—Ç–≤–µ—Ä–≥–∞", fri:"–í–µ—á–µ—Ä –ø—è—Ç–Ω–∏—Ü—ã", wknd:"–í—ã—Ö–æ–¥–Ω—ã–µ"}[code]);
  const dayHuman = code => ({thu:"–≤ —á–µ—Ç–≤–µ—Ä–≥ –≤–µ—á–µ—Ä–æ–º", fri:"–≤ –ø—è—Ç–Ω–∏—Ü—É –≤–µ—á–µ—Ä–æ–º", wknd:"–Ω–∞ –≤—ã—Ö–æ–¥–Ω—ã—Ö"}[code]);
  const modeHuman = m => (m==="museum" ? "–≤ –º—É–∑–µ–π —Ç–µ–º–Ω–æ—Ç—ã ‚Äî –°–µ–Ω—Å–æ—Ä–∏—É–º" : "–Ω–∞ —É–∂–∏–Ω");

  function send(payload){ try{ tg?.sendData?.(JSON.stringify(payload)); }catch(e){alert("–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!");} }

  function finish(mode, day){
    if (mode) localStorage.setItem(K_MODE, mode);
    if (day)  localStorage.setItem(K_DAY, day);
    localStorage.setItem(K_DONE,"1");

    const m = localStorage.getItem(K_MODE);
    const d = localStorage.getItem(K_DAY);

    el.className="card fade";
    el.innerHTML = ` x ${tg}
      <p>–ñ–¥—É —Å –Ω–µ—Ç–µ—Ä–ø–µ–Ω–∏–µ–º, ü•∞ –∫—Ä–∞—Å–æ—Ç–∫–∞ </p>
      <p><strong>–£–≤–∏–¥–∏–º—Å—è ${dayHuman(d)} ${m==="museum"?"":" "}</strong></p>
    `;
    send({type:"sensorium_choice", mode:m, day:d});
  }

  function chooseDay(mode){
    el.className="card fade";
    el.innerHTML = `
      <p>${mode==="museum"
          ? "üòç –û—Ç–ª–∏—á–Ω–æ. –¢–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞–π:"
          : "–¢–æ–≥–¥–∞ –¥–∞–≤–∞–π –ø—Ä–æ—Å—Ç–æ –ø–æ—É–∂–∏–Ω–∞–µ–º –≥–¥–µ-–Ω–∏–±—É–¥—å. –ö–æ–≥–¥–∞ —É–¥–æ–±–Ω–æ?"}</p>
      <div style="margin-top:6px">
        <button class="btn" data-day="thu">${dayLabel("thu")}</button>
        <button class="btn" data-day="fri">${dayLabel("fri")}</button>
        <button class="btn" data-day="wknd">${dayLabel("wknd")}</button>
      </div>
    `;
    el.querySelectorAll("[data-day]").forEach(b=>{
      b.onclick=()=>finish(mode, b.dataset.day);
    });
  }

  // Four-step flow
  const steps = [
    { t:`–ü—Ä–∏–≤–µ—Ç, –û—á–∞—Ä–æ–≤–∞—à–∫–∞. –ú—ã –æ–±–∞ –ª—é–±–∏–º —Ö–æ—Ä—Ä–æ—Ä—ã (–ø–æ—Å—Ç-—Ö–æ—Ä—Ä–æ—Ä—ã üôÇ) –∏ –Ω–µ–æ–±—ã—á–Ω—ã–µ –≤–µ—â–∏`, next:1 },
    { t:`–í —Ç–µ–º–Ω–æ—Ç–µ –µ—Å—Ç—å —á—Ç–æ-—Ç–æ –ø—Ä–∏—Ç—è–≥–∞—Ç–µ–ª—å–Ω–æ–µ<br>–ö–∞–∂–µ—Ç—Å—è, –±—É–¥—Ç–æ –≤—Å—ë –ø–æ–¥–ª–∏–Ω–Ω–æ–µ –∂–∏–≤—ë—Ç –∏–º–µ–Ω–Ω–æ —Ç–∞–º`, next:2 },
    { t:`–ö–æ–≥–¥–∞ —Å–≤–µ—Ç –≥–∞—Å–Ω–µ—Ç,<br>–¥–∞–∂–µ –ø—Ä–∏–≤—ã—á–Ω—ã–µ –≤–µ—â–∏ –æ–±—Ä–µ—Ç–∞—é—Ç –≥–ª—É–±–∏–Ω—É`, next:3 },
    { t:`–ü—Ä–∏–≥–ª–∞—à–∞—é —Ç–µ–±—è –≤ –º—É–∑–µ–π —Ç–µ–º–Ω–æ—Ç—ã - <strong>–°–µ–Ω—Å–æ—Ä–∏—É–º</strong>`,
      buttons:[
        { text:"üòá –í–∞—É, —è —Å–æ–≥–ª–∞—Å–Ω–∞", action:()=>chooseDay("museum") },
        { text:"üòÖ –ê —è —Ç–∞–º —É–∂–µ –±—ã–ª–∞", action:()=>chooseDay("dinner") }
      ]
    }
  ];

  function renderStep(i){
    const s = steps[i];
    el.className="card fade";
    if (s.buttons){
      el.innerHTML = `<p>${s.t}</p>` + s.buttons.map(b=>`<button class="btn">${b.text}</button>`).join("");
      [...el.querySelectorAll(".btn")].forEach((btn,idx)=>btn.onclick=s.buttons[idx].action);
    } else {
      el.innerHTML = `<p>${s.t}</p><button class="btn">–î–∞–ª—å—à–µ</button>`;
      el.querySelector(".btn").onclick = ()=>renderStep(s.next);
    }
  }

  // Auto-final if already chosen earlier
  if (localStorage.getItem(K_DONE)==="1" && localStorage.getItem(K_MODE) && localStorage.getItem(K_DAY)) {
    finish(); // uses stored values
  } else {
    renderStep(0);
  }
    });
</script>
</body>
</html>
